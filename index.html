<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JT Print - Professioneller 3D-Druck Service</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Header -->
    <header>
        <nav>
            <div class="logo-container">
                <img src="https://i.postimg.cc/433yTPrC/296ae7d7-58c3-4968-b8a8-e6b6add85135-removebg-preview.png" alt="JT Print Logo" class="logo-image">
                <span class="logo-text">JT Print</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#gallery">Galerie</a></li>
                <li><a href="#products">Produkte</a></li>
                <li id="nav-auth">
                    <button class="btn-secondary" onclick="showLoginModal()">Anmelden</button>
                </li>
                <li class="hidden" id="nav-cart">
                    <div class="cart-icon" onclick="showCart()">
                        üõí <span class="cart-count">0</span>
                    </div>
                </li>
                <li class="hidden" id="nav-settings">
                    <button class="btn-secondary" onclick="showSettingsModal()">‚öôÔ∏è</button>
                </li>
            </ul>
        </nav>

        <!-- Admin Tabs -->
        <div id="adminTabs" class="admin-tabs hidden">
            <button class="admin-tab active" onclick="switchAdminTab('orders')">üì¶ Bestellungen</button>
            <button class="admin-tab" onclick="switchAdminTab('products')">üõçÔ∏è Produkte</button>
            <button class="admin-tab" onclick="switchAdminTab('gallery')">üé® Galerie</button>
            <button class="admin-tab" onclick="switchAdminTab('chat')">üí¨ Chat-Anfragen</button>
        </div>
    </header>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel hidden">
        <!-- Order Management -->
        <div id="admin-orders" class="admin-content active">
            <div class="admin-header">
                <h2>Bestellverwaltung</h2>
                <div class="filter-buttons">
                    <button class="btn-secondary" onclick="filterOrders('all')">Alle</button>
                    <button class="btn-secondary" onclick="filterOrders('pending')">Ausstehend</button>
                    <button class="btn-secondary" onclick="filterOrders('processing')">In Bearbeitung</button>
                    <button class="btn-secondary" onclick="filterOrders('completed')">Abgeschlossen</button>
                </div>
            </div>
            <div id="ordersList" class="orders-list"></div>
        </div>

        <!-- Product Management -->
        <div id="admin-products" class="admin-content">
            <div class="admin-header">
                <h2>Produktverwaltung</h2>
                <button class="btn-primary" onclick="showAddProductModal()">+ Neues Produkt</button>
            </div>
            <div id="productsList" class="products-list"></div>
        </div>

        <!-- Gallery Management -->
        <div id="admin-gallery" class="admin-content">
            <div class="admin-header">
                <h2>Galerie-Verwaltung</h2>
                <button class="btn-primary" onclick="showAddGalleryModal()">+ Neues Galerie-Bild</button>
            </div>
            <div id="galleryList" class="gallery-admin-list"></div>
        </div>

        <!-- Chat Management -->
        <div id="admin-chat" class="admin-content">
            <div class="admin-header">
                <h2>Chat-Anfragen</h2>
            </div>
            <div id="chatRequestsList" class="chat-requests-list"></div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <h1>Professioneller 3D-Druck f√ºr Ihre Ideen</h1>
        <p>Laden Sie Ihr Design hoch oder lassen Sie uns Ihr individuelles 3D-Modell erstellen. Pr√§zise Fertigung mit modernster Technologie.</p>
        <div class="hero-buttons">
            <button class="btn-primary" onclick="showUploadModal()">Design hochladen</button>
            <button class="btn-secondary" onclick="showCustomDesignModal()">Custom Design anfragen</button>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <section id="services">
            <h2 class="section-title">Unsere Services</h2>
            <div class="services-grid">
                <div class="service-card">
                    <h3>üñ®Ô∏è 3D-Druck Service</h3>
                    <p>Laden Sie Ihre STL-Datei hoch oder beschreiben Sie Ihr Wunschmodell. Wir drucken es f√ºr Sie mit hochwertigen Materialien.</p>
                    <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                        <li>Bambu Lab P1S Drucker</li>
                        <li>Druckgr√∂√üe bis 25x25cm</li>
                        <li>Alle g√§ngigen Materialien</li>
                        <li>50% Rabatt auf PLA-Grundpreis!</li>
                    </ul>
                </div>
                <div class="service-card">
                    <h3>‚úèÔ∏è Custom Design Service</h3>
                    <p>Ben√∂tigen Sie ein individuelles 3D-Modell? Beschreiben Sie Ihre Idee und wir erstellen das perfekte Design f√ºr Sie.</p>
                    <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                        <li>Professionelle CAD-Modellierung</li>
                        <li>OnShape-Software</li>
                        <li>20‚Ç¨/Stunde oder VB</li>
                        <li>Design + Fertigung</li>
                    </ul>
                </div>
                <div class="service-card">
                    <h3>‚ö° Express-Service</h3>
                    <p>Brauchen Sie Ihr Modell schnell? Mit unserem Express-Service erhalten Sie Ihren Druck priorisiert.</p>
                    <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                        <li>Bevorzugte Bearbeitung</li>
                        <li>Schnellere Lieferung</li>
                        <li>Status-Updates</li>
                        <li>+30% Aufpreis</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="gallery">
            <h2 class="section-title">Portfolio & Beispiele</h2>
            <div class="product-grid" id="gallery-grid"></div>
        </section>

        <section id="products">
            <h2 class="section-title">Produktkatalog</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('internet')">Internet-Modelle</button>
                <button class="tab" onclick="switchTab('custom')">Eigene Designs</button>
            </div>

            <div id="internet-tab" class="tab-content active">
                <div class="product-grid" id="internet-products"></div>
            </div>

            <div id="custom-tab" class="tab-content">
                <div class="product-grid" id="custom-products"></div>
            </div>
        </section>
    </div>

    <!-- Chat Widget -->
    <div class="chat-widget">
        <button class="chat-button" onclick="toggleChat()">üí¨</button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                Custom Design Anfrage
                <button class="modal-close" onclick="toggleChat()" style="position: absolute; right: 1rem; top: 0.5rem; color: white;">&times;</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message admin">
                    Hallo! Ich bin hier um Ihnen bei Ihrem Custom Design zu helfen. Beschreiben Sie mir einfach Ihre Idee und ich erstelle Ihnen ein Angebot.<br><br>
                    <strong>Mein Stundensatz: 20‚Ç¨/h oder Preisvorschlag</strong><br><br>
                    <em>Hinweis: M√∂glicherweise werden Sie nach weiteren Informationen √ºber das Design gefragt (z.B. genaue Ma√üe, Verwendungszweck, Materialw√ºnsche).</em>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ihre Nachricht..." onkeypress="handleChatKeyPress(event)">
                <button class="btn-primary" onclick="sendChatMessage()" style="padding: 0.75rem 1rem;">Senden</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
            <h2>Anmelden</h2>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div id="loginError" class="error-message hidden"></div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Anmelden</button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary);">
                Noch kein Konto? <a href="#" onclick="showRegisterModal()" style="color: var(--primary-green);">Registrieren</a>
            </p>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
            <h2>Registrieren</h2>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label>Geburtsdatum</label>
                    <input type="date" id="registerBirthdate" required>
                </div>
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Passwort wiederholen</label>
                    <input type="password" id="registerPasswordConfirm" required>
                </div>
                <div id="registerError" class="error-message hidden"></div>
                <div id="registerSuccess" class="success-message hidden"></div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Registrieren</button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                <strong>Wichtig:</strong> Bitte √ºberpr√ºfen Sie auch Ihren Spam-Ordner f√ºr die Best√§tigungs-E-Mail!
            </p>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('settingsModal')">&times;</button>
            <h2>Kontoeinstellungen</h2>
            <div class="settings-section">
                <h3>Pers√∂nliche Informationen</h3>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="settingsName" readonly>
                </div>
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="settingsEmail" readonly>
                </div>
                <div class="form-group">
                    <label>Geburtsdatum</label>
                    <input type="date" id="settingsBirthdate" readonly>
                </div>
            </div>
            <div class="settings-section">
                <h3>Benachrichtigungen</h3>
                <div id="userNotifications" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            <button class="btn-secondary" onclick="closeModal('settingsModal')" style="width: 100%; margin-top: 1rem;">Schlie√üen</button>
        </div>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('uploadModal')">&times;</button>
            <h2>3D-Modell hochladen</h2>
            <form id="uploadForm" onsubmit="handleUpload(event)">
                <div class="form-group">
                    <label>STL-Datei oder Beschreibung</label>
                    <textarea id="uploadDescription" placeholder="Beschreiben Sie Ihr Wunschmodell oder laden Sie eine STL-Datei hoch..." required></textarea>
                </div>
                
                <div class="price-calculator">
                    <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Preiskalkulator</h3>
                    <div class="form-group">
                        <label>Gesch√§tztes Gewicht (Gramm)</label>
                        <input type="number" id="weight" min="1" step="0.1" required oninput="calculatePrice()">
                    </div>
                    <div class="form-group">
                        <label>Nozzle-Gr√∂√üe</label>
                        <select id="nozzleSize" onchange="calculatePrice()">
                            <option value="0.4">0,4mm Hardened Steel (Standard)</option>
                            <option value="0.2">0,2mm Stainless Steel (+4‚Ç¨, nur PLA)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Material</label>
                        <select id="material" onchange="calculatePrice()">
                            <option value="pla">PLA (Standard - 50% Rabatt!)</option>
                            <option value="tpu">TPU (Flexibel)</option>
                            <option value="asa">ASA (UV-best√§ndig)</option>
                            <option value="abs">ABS (Hitzebest√§ndig)</option>
                            <option value="petg">PETG (Robust)</option>
                            <option value="pla-cf">PLA Carbon Fiber</option>
                            <option value="petg-cf">PETG Carbon Fiber</option>
                            <option value="pla-wood">PLA Wood (Holzoptik)</option>
                            <option value="pla-glow">PLA Glow (Leuchtend)</option>
                            <option value="pla-marble">PLA Marble (Marmor)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Express-Service</label>
                        <select id="express" onchange="calculatePrice()">
                            <option value="no">Nein</option>
                            <option value="yes">Ja (+30%)</option>
                        </select>
                    </div>
                    <div class="price-result hidden" id="priceResult">
                        <p>Gesch√§tzter Preis:</p>
                        <p class="amount" id="priceAmount">0.00‚Ç¨</p>
                        <p style="font-size: 0.875rem; opacity: 0.8;" id="priceBreakdown"></p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Anmerkungen (optional)</label>
                    <textarea id="uploadNotes" placeholder="Besondere W√ºnsche, Farben, etc."></textarea>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">In den Warenkorb</button>
            </form>
        </div>
    </div>

    <div id="productDetailModal" class="modal">
        <div class="modal-content modal-content-large">
            <button class="modal-close" onclick="closeModal('productDetailModal')">&times;</button>
            <div class="product-detail-grid">
                <div>
                    <div id="detailImage" class="detail-image-container"></div>
                    <div id="detailThumbnails" class="detail-thumbnails"></div>
                </div>
                <div>
                    <h2 id="detailName"></h2>
                    <p id="detailDescription" style="color: var(--text-secondary); margin: 1rem 0;"></p>
                    <div style="margin: 1rem 0;">
                        <span class="product-price" id="detailPrice"></span>
                    </div>
                    
                    <div class="form-group">
                        <label>Farbe w√§hlen</label>
                        <div class="color-selector" id="colorSelector"></div>
                    </div>

                    <div class="form-group">
                        <label>Menge</label>
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                            <span class="quantity-display" id="quantityDisplay">1</span>
                            <button type="button" class="quantity-btn" onclick="changeQuantity(1)">+</button>
                        </div>
                    </div>

                    <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="addDetailProductToCart()">In den Warenkorb</button>
                </div>
            </div>
        </div>
    </div>

    <div id="cartModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close" onclick="closeModal('cartModal')">&times;</button>
            <h2>Warenkorb</h2>
            <div id="cartItems"></div>
            <div id="cartTotal" style="margin-top: 2rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                <h3 style="text-align: right; color: var(--primary-green);">Gesamt: <span id="totalAmount">0.00‚Ç¨</span></h3>
            </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="proceedToCheckout()">Zur Kasse</button>
        </div>
    </div>

    <div id="checkoutModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeModal('checkoutModal')">&times;</button>
            <h2>Bestellung abschlie√üen</h2>
            <form id="checkoutForm" onsubmit="handleCheckout(event)">
                <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Lieferung</h3>
                <div class="form-group">
                    <label>Versandart</label>
                    <select id="shippingMethod" onchange="updateShipping()" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="pickup">Selbstabholung (Kostenlos)</option>
                        <option value="standard">Standard-Versand (4.99‚Ç¨)</option>
                        <option value="express">Express-Versand (9.99‚Ç¨)</option>
                    </select>
                </div>

                <div id="addressFields" class="hidden">
                    <div class="form-group">
                        <label>Stra√üe und Hausnummer</label>
                        <input type="text" id="street">
                    </div>
                    <div class="form-group">
                        <label>Postleitzahl</label>
                        <input type="text" id="zipCode">
                    </div>
                    <div class="form-group">
                        <label>Stadt</label>
                        <input type="text" id="city">
                    </div>
                    <div class="form-group">
                        <label>Land</label>
                        <input type="text" id="country" value="Deutschland">
                    </div>
                </div>

                <h3 style="color: var(--primary-green); margin: 2rem 0 1rem;">Gutscheincode</h3>
                <div class="form-group">
                    <input type="text" id="couponCode" placeholder="Gutscheincode eingeben">
                    <button type="button" class="btn-secondary" style="margin-top: 0.5rem;" onclick="applyCoupon()">Einl√∂sen</button>
                </div>

                <h3 style="color: var(--primary-green); margin: 2rem 0 1rem;">Zahlungsmethode</h3>
                <div class="form-group">
                    <select id="paymentMethod" onchange="handlePaymentMethodChange()" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="paypal">PayPal</option>
                        <option value="stripe">Kreditkarte (Stripe)</option>
                        <option value="transfer">√úberweisung</option>
                        <option value="private">Privat (nur f√ºr Bekannte)</option>
                    </select>
                    <div id="privatePaymentWarning" class="hidden" style="background: var(--card-bg); padding: 1rem; border-radius: 8px; margin-top: 1rem; border: 2px solid #ff4444;">
                        <p style="color: #ff4444; font-weight: 600;">‚ö†Ô∏è Warnung</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Diese Zahlungsoption ist aktuell nur f√ºr bekannte Nutzer verf√ºgbar. Wenn Sie diese Option trotzdem ausw√§hlen, wird Ihre Bestellung m√∂glicherweise ignoriert.</p>
                    </div>
                </div>

                <div style="background: var(--card-bg); padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">
                    <h4 style="color: var(--primary-green);">Bestell√ºbersicht</h4>
                    <div style="margin-top: 1rem; color: var(--text-secondary);">
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Zwischensumme:</span>
                            <span id="checkoutSubtotal">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Versandkosten:</span>
                            <span id="shippingCost">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Rabatt:</span>
                            <span id="discount">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); font-size: 1.25rem; color: var(--primary-green); font-weight: 700;">
                            <span>Gesamt:</span>
                            <span id="checkoutTotal">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%;">Zahlungspflichtig bestellen</button>
            </form>
        </div>
    </div>

    <!-- Admin Modals -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
            <h2 id="productModalTitle">Neues Produkt hinzuf√ºgen</h2>
            <form id="addProductForm" onsubmit="handleAddProduct(event)">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label>Produktname</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Beschreibung</label>
                    <textarea id="productDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label>Preis (‚Ç¨)</label>
                    <input type="number" id="productPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Gewicht (g)</label>
                    <input type="number" id="productWeight" min="1" required>
                </div>
                <div class="form-group">
                    <label>Kategorie</label>
                    <select id="productCategory" required>
                        <option value="internet">Internet-Modelle</option>
                        <option value="custom">Eigene Designs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bild-URLs (eine pro Zeile f√ºr verschiedene Farben)</label>
                    <textarea id="productImages" placeholder="https://example.com/bild1.jpg&#10;https://example.com/bild2.jpg" rows="4"></textarea>
                    <small style="color: var(--text-secondary);">Tipp: Verwenden Sie Imgur.com oder ImgBB.com zum Hochladen</small>
                </div>
                <div class="form-group">
                    <label>Verf√ºgbare Farben (Hex-Codes, eine pro Zeile)</label>
                    <textarea id="productColors" placeholder="#000000&#10;#FFFFFF&#10;#0066cc" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Auf Lager</label>
                    <select id="productInStock">
                        <option value="true">Ja</option>
                        <option value="false">Nein</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Speichern</button>
            </form>
        </div>
    </div>

    <div id="orderDetailModal" class="modal">
        <div class="modal-content modal-content-large">
            <button class="modal-close" onclick="closeModal('orderDetailModal')">&times;</button>
            <h2>Bestelldetails</h2>
            <div id="orderDetailContent"></div>
        </div>
    </div>

    <div id="notifyCustomerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('notifyCustomerModal')">&times;</button>
            <h2>Kunde benachrichtigen</h2>
            <form id="notifyForm" onsubmit="handleNotifyCustomer(event)">
                <input type="hidden" id="notifyOrderId">
                <div class="form-group">
                    <label>Nachrichtentyp</label>
                    <select id="notifyType" required>
                        <option value="price">Preis√§nderung</option>
                        <option value="time">Zeit√§nderung</option>
                        <option value="question">R√ºckfrage</option>
                        <option value="custom">Benutzerdefiniert</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nachricht</label>
                    <textarea id="notifyMessage" required placeholder="Ihre Nachricht an den Kunden..."></textarea>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Benachrichtigung senden</button>
            </form>
        </div>
    </div>

    <!-- Firebase Integration -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, doc, setDoc, updateDoc, deleteDoc, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
          apiKey: "AIzaSyDazql6oJx5_z3hASwmo4200-OpQhodZVc",
          authDomain: "d-druckservice-jtprint.firebaseapp.com",
          projectId: "d-druckservice-jtprint",
          storageBucket: "d-druckservice-jtprint.firebasestorage.app",
          messagingSenderId: "247787543764",
          appId: "1:247787543764:web:b3cc1e7d05eb8aa2abef41"
     };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            sendEmailVerification, 
            onAuthStateChanged,
            signOut
        };
        window.firebaseDbFunctions = { collection, addDoc, getDocs, query, where, doc, setDoc, updateDoc, deleteDoc, orderBy, onSnapshot };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const isAdmin = user.email === 'jona.thielgen@gmail.com';
                window.isAdmin = isAdmin;
                
                document.getElementById('nav-auth').innerHTML = `
                    <span style="color: var(--text-secondary);">${user.email}</span>
                    <button class="btn-secondary" onclick="handleLogout()">Abmelden</button>
                `;
                document.getElementById('nav-cart').classList.remove('hidden');
                document.getElementById('nav-settings').classList.remove('hidden');
                
                if (isAdmin) {
                    document.getElementById('adminTabs').classList.remove('hidden');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    document.querySelector('.hero').style.display = 'none';
                    document.querySelector('.container').style.display = 'none';
                    loadAdminData();
                } else {
                    document.getElementById('adminTabs').classList.add('hidden');
                    document.getElementById('adminPanel').classList.add('hidden');
                    document.querySelector('.hero').style.display = 'block';
                    document.querySelector('.container').style.display = 'block';
                }
                
                loadProducts();
                loadUserSettings(user);
            } else {
                document.getElementById('nav-auth').innerHTML = `
                    <button class="btn-secondary" onclick="showLoginModal()">Anmelden</button>
                `;
                document.getElementById('nav-cart').classList.add('hidden');
                document.getElementById('nav-settings').classList.add('hidden');
                document.getElementById('adminTabs').classList.add('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
                document.querySelector('.hero').style.display = 'block';
                document.querySelector('.container').style.display = 'block';
                loadProducts();
            }
        });

        async function loadProducts() {
            try {
                const productsQuery = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'products')
                );
                
                window.allProducts = [];
                productsQuery.forEach((doc) => {
                    window.allProducts.push({ id: doc.id, ...doc.data() });
                });
                
                displayProducts();
                displayGallery();
            } catch (error) {
                console.log('Laden von Beispieldaten...');
                loadSampleProducts();
            }
        }

        window.loadProducts = loadProducts;
    </script>

    <script src="script.js"></script>
</body>
</html>
