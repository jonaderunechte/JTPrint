<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JT Print â€“ 3D-Druck Service</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="style_admin.css">
</head>
<body>
<div class="bg-anim"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â• HEADERâ•â•â•â•â•â•â•â•â•â•â• -->
<header>
  <nav>
    <a href="#" class="logo" onclick="showShop(); return false;">
      <img src="https://i.postimg.cc/433yTPrC/296ae7d7-58c3-4968-b8a8-e6b6add85135-removebg-preview.png" alt="JT Print Logo">
      <span class="logo-txt">JT Print</span>
    </a>
    <ul class="nav-links" id="nav-links">
      <li><a href="#" onclick="showShop(); smoothScrollTo('home'); return false;">Home</a></li>
      <li><a href="#" onclick="showShop(); smoothScrollTo('services'); return false;">Services</a></li>
      <li><a href="#" onclick="showShop(); smoothScrollTo('gallery'); return false;">Galerie</a></li>
      <li><a href="#" onclick="showShop(); smoothScrollTo('products'); return false;">Produkte</a></li>
    </ul>
    <div class="nav-right" id="nav-auth">
      <button class="btn btn-sec" onclick="openModal('loginModal')">Anmelden</button>
    </div>
  </nav>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â• SHOP SECTION â•â•â•â•â•â•â•â•â•â•â• -->
<div id="shop-section">
  <!-- Hero -->
  <div class="hero" id="home">
    <h1>Professioneller 3D-Druck<br>fÃ¼r Ihre Ideen</h1>
    <p>Laden Sie Ihr Design hoch oder lassen Sie uns Ihr individuelles 3D-Modell erstellen. PrÃ¤zision mit der Bambu Lab P1S.</p>
    <div class="hero-btns">
      <button class="btn btn-pri" onclick="openUploadModal()">ğŸ“ Design hochladen</button>
      <button class="btn btn-sec" onclick="openCustomDesign()">âœï¸ Custom Design</button>
    </div>
  </div>

  <div class="container">
    <!-- Services -->
    <section id="services">
      <h2 class="sec-title">Unsere Services</h2>
      <div class="svc-grid">
        <div class="svc-card">
          <h3>ğŸ–¨ï¸ 3D-Druck Service</h3>
          <p>Laden Sie Ihre STL-Datei hoch oder beschreiben Sie Ihr Modell.</p>
          <ul><li>Bambu Lab P1S Drucker</li><li>DruckgrÃ¶ÃŸe bis 25Ã—25 cm</li><li>Hardened Steel & Stainless Steel DÃ¼sen</li><li>50 % Rabatt auf PLA-Grundpreis!</li></ul>
        </div>
        <div class="svc-card">
          <h3>âœï¸ Custom Design</h3>
          <p>Wir modellieren Ihr individuelles 3D-Modell in OnShape.</p>
          <ul><li>Professionelle CAD-Modellierung</li><li>20 â‚¬/h oder Preisvorschlag</li><li>Ggf. werden weitere Infos zum Design abgefragt</li><li>Design + Fertigung</li></ul>
        </div>
        <div class="svc-card">
          <h3>âš¡ Express-Service</h3>
          <p>Priorisierter Druck fÃ¼r dringende AuftrÃ¤ge.</p>
          <ul><li>Bevorzugte Bearbeitung</li><li>3â€“5 Werktage</li><li>Status-Updates</li><li>+30 % Aufpreis</li></ul>
        </div>
      </div>
    </section>

    <!-- Gallery -->
    <section id="gallery">
      <h2 class="sec-title">Portfolio & Galerie</h2>
      <div class="prod-grid" id="gallery-grid"></div>
    </section>

    <!-- Products -->
    <section id="products">
      <h2 class="sec-title">Produktkatalog</h2>
      <div class="tabs">
        <button class="tab active" onclick="switchProdTab('internet',this)">ğŸŒ Internet-Modelle</button>
        <button class="tab"        onclick="switchProdTab('custom',this)">âœï¸ Eigene Designs</button>
      </div>
      <div id="internet-tab" class="tab-content active"><div class="prod-grid" id="internet-products"></div></div>
      <div id="custom-tab"   class="tab-content">       <div class="prod-grid" id="custom-products"></div></div>
    </section>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• ADMIN PANEL â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-panel" class="hidden">
  <div class="container">
    <h2 class="sec-title" style="margin-top:1rem">ğŸ›¡ï¸ Admin Panel</h2>
    <!-- Admin tab bar -->
    <div class="admin-tabs">
      <button class="admin-tab active" data-tab="orders"   onclick="switchAdminTab('orders')">ğŸ“¦ Bestellungen</button>
      <button class="admin-tab"        data-tab="products" onclick="switchAdminTab('products')">ğŸ·ï¸ Produkte</button>
      <button class="admin-tab"        data-tab="gallery"  onclick="switchAdminTab('gallery')">ğŸ–¼ï¸ Galerie</button>
      <button class="btn btn-sec btn-sm" onclick="showShop()" style="margin-left:auto">â† Shop</button>
    </div>

    <!-- Orders -->
    <div class="admin-section active" id="admin-orders">
      <div id="orders-list"></div>
    </div>

    <!-- Products -->
    <div class="admin-section" id="admin-products">
      <div class="editor-grid">
        <!-- Left: existing products list -->
        <div class="editor-left">
          <h3 style="color:var(--green);font-size:.95rem;font-family:'Orbitron',sans-serif">Bestehende Produkte</h3>
          <div class="prod-list" id="prod-editor-list"></div>
        </div>
        <!-- Right: add / edit form -->
        <div class="editor-right">
          <h4 id="pe-form-title">Neues Produkt hinzufÃ¼gen</h4>
          <div class="fg"><label>Name</label><input type="text" id="pe-name"></div>
          <div class="fg"><label>Beschreibung</label><textarea id="pe-desc" style="min-height:60px"></textarea></div>
          <div style="display:flex;gap:.7rem;flex-wrap:wrap">
            <div class="fg" style="flex:1"><label>Preis (â‚¬)</label><input type="number" id="pe-price" step="0.01" min="0"></div>
            <div class="fg" style="flex:1"><label>Gewicht (g)</label><input type="number" id="pe-weight" min="0"></div>
          </div>
          <div style="display:flex;gap:.7rem;flex-wrap:wrap">
            <div class="fg" style="flex:1"><label>Emoji</label><input type="text" id="pe-emoji" value="ğŸ“¦" style="width:60px"></div>
            <div class="fg" style="flex:1"><label>Kategorie</label>
              <select id="pe-category"><option value="internet">Internet-Modelle</option><option value="custom">Eigene Designs</option></select>
            </div>
            <div class="fg" style="flex:0;align-self:flex-end;padding-bottom:.2rem">
              <label><input type="checkbox" id="pe-instock" checked> Auf Lager</label>
            </div>
          </div>
          <!-- Colors -->
          <label style="color:var(--txt2);font-size:.85rem;font-weight:500">Farben</label>
          <div class="color-input-row mt1" id="pe-colors"></div>
          <div style="display:flex;gap:.4rem;align-items:center;margin-top:.5rem">
            <input type="color" id="pe-new-color" style="width:36px;height:28px;border:none;background:none;cursor:pointer">
            <button class="btn btn-sec btn-sm" onclick="addColorChip()">+ Farbe</button>
          </div>
          <!-- Images -->
          <label style="color:var(--txt2);font-size:.85rem;font-weight:500;margin-top:.7rem;display:block">Bilder (URLs)</label>
          <div class="img-url-list mt1" id="pe-images">
            <div class="img-url-item"><input type="text" placeholder="Bild-URL (optional)"><button onclick="removeImgUrl(this)">âœ•</button></div>
          </div>
          <button class="btn btn-sec btn-sm mt1" onclick="addImgUrl()">+ Bild-URL</button>
          <!-- Save -->
          <div style="display:flex;gap:.5rem;margin-top:1rem">
            <button class="btn btn-pri w-full" id="pe-submit-btn" onclick="saveProduct()">+ Produkt hinzufÃ¼gen</button>
            <button class="btn btn-sec btn-sm" onclick="resetProductForm()">â†º</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Gallery Editor -->
    <div class="admin-section" id="admin-gallery">
      <h3 style="color:var(--green);font-size:.95rem;font-family:'Orbitron',sans-serif;margin-bottom:.8rem">Galerie verwalten</h3>
      <div class="gallery-grid" id="gallery-editor-grid"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• CHAT WIDGET â•â•â•â•â•â•â•â•â•â•â• -->
<div class="chat-widget">
  <button class="chat-fab" onclick="toggleChat()">ğŸ’¬</button>
  <div class="chat-win" id="chatWin">
    <div class="chat-head">
      <span>ğŸ’¬ Custom Design Chat</span>
      <button onclick="toggleChat()">âœ•</button>
    </div>
    <div class="chat-msgs" id="chat-msgs">
      <div class="chat-m b">
        Hallo! ğŸ‘‹ Beschreiben Sie Ihr Wunschmodell und ich erstelle ein Angebot fÃ¼r Sie.<br><br>
        <strong>Stundensatz:</strong> 20â‚¬/h oder Preisvorschlag
      </div>
    </div>
    <div class="chat-input-wrap">
      <input type="text" id="chat-input" placeholder="Nachricht schreibenâ€¦" onkeydown="chatKeydown(event)">
      <button onclick="sendChat()">â¤</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Login / Register -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('loginModal')">Ã—</button>
    <h2>ğŸ” Anmelden / Registrieren</h2>
    <form onsubmit="handleLogin(event)">
      <div class="fg"><label>E-Mail</label><input type="email" id="log-email" required></div>
      <div class="fg"><label>Passwort</label><input type="password" id="log-pw" required minlength="6"></div>
      <div class="err hidden" id="log-err"></div>
      <button type="submit" class="btn btn-pri w-full">Anmelden</button>
      <button type="button" class="btn btn-sec w-full mt1" onclick="handleRegister(event)">Registrieren</button>
    </form>
  </div>
</div>

<!-- Upload Modal -->
<div class="modal" id="uploadModal">
  <div class="modal-box modal-large">
    <button class="modal-x" onclick="closeModal('uploadModal')">Ã—</button>
    <h2>ğŸ“ Design hochladen</h2>
    <form onsubmit="handleUpload(event)">
      <div class="fg"><label>Beschreibung / Name</label><textarea id="upload-desc" placeholder="Was soll gedruckt werden?" required></textarea></div>
      <div class="info-box">Sie kÃ¶nnen Ihre STL-Datei spÃ¤ter per E-Mail an <strong>jona.thielgen@gmail.com</strong> senden oder Ã¼ber Ihre Bestell-Chat hochladen.</div>
      <div class="fg"><label>GeschÃ¤tztes Gewicht (g)</label><input type="number" id="upload-weight" min="1" required oninput="calculatePrice()"></div>
      <div class="fg"><label>Material</label>
        <select id="upload-material" onchange="onMaterialChange()">
          <option value="PLA">PLA (50% Rabatt auf Grundpreis!)</option>
          <option value="TPU">TPU (+10â‚¬)</option>
          <option value="ASA">ASA (+10â‚¬)</option>
          <option value="ABS">ABS (+10â‚¬)</option>
          <option value="PETG">PETG (+10â‚¬)</option>
          <option value="PLA CF">PLA CF (+10â‚¬)</option>
          <option value="PETG CF">PETG CF (+10â‚¬)</option>
          <option value="PLA Wood">PLA Wood (+10â‚¬)</option>
          <option value="PLA Glow">PLA Glow (+10â‚¬)</option>
          <option value="PLA Marble">PLA Marble (+10â‚¬)</option>
          <option value="ABS CF">ABS CF (+10â‚¬)</option>
          <option value="PETG HF">PETG HF (+10â‚¬)</option>
          <option value="Silk PLA">Silk PLA (+10â‚¬)</option>
        </select>
      </div>
      <!-- Nozzle selection (only PLA) -->
      <div class="fg hidden" id="nozzle-wrap">
        <label>DÃ¼se</label>
        <div style="display:flex;gap:.8rem;margin-top:.3rem">
          <label style="cursor:pointer;font-weight:400"><input type="radio" name="nozzle" id="nozzle-04" value="0.4" checked onchange="calculatePrice()"> 0.4 Hardened Steel (Standard)</label>
          <label style="cursor:pointer;font-weight:400"><input type="radio" name="nozzle" id="nozzle-02" value="0.2" onchange="calculatePrice()"> 0.2 Stainless Steel (+4â‚¬, PLA only)</label>
        </div>
      </div>
      <div class="fg"><label>Express-Service</label>
        <select id="upload-express" onchange="calculatePrice()">
          <option value="no">Nein (Standard)</option>
          <option value="yes">Ja (+30%)</option>
        </select>
      </div>
      <div class="fg"><label>ZusÃ¤tzliche Notizen (optional)</label><textarea id="upload-notes" placeholder="Farbe, Besonderheiten, â€¦"></textarea></div>
      
      <!-- IMPROVED PRICE DISPLAY -->
      <div class="price-calc hidden" id="price-result">
        <div class="price-header">
          <h4>ğŸ’° GeschÃ¤tzter Preis</h4>
          <div class="price-amt" id="price-amount">0.00â‚¬</div>
        </div>
        <div class="price-breakdown-wrapper">
          <div class="price-breakdown" id="price-breakdown"></div>
        </div>
      </div>
      
      <button type="submit" class="btn btn-pri w-full mt1">ğŸ›’ Zum Warenkorb hinzufÃ¼gen</button>
    </form>
  </div>
</div>

<!-- Product Detail Modal -->
<div class="modal" id="productDetailModal">
  <div class="modal-box modal-large">
    <button class="modal-x" onclick="closeModal('productDetailModal')">Ã—</button>
    <div class="det-grid">
      <div class="det-left">
        <div class="det-img-wrap" id="det-img-wrap"></div>
        <div class="det-thumbs" id="det-thumbs"></div>
      </div>
      <div class="det-right">
        <h2 id="det-name">Produktname</h2>
        <div class="det-price" id="det-price">0.00â‚¬</div>
        <p id="det-desc" style="color:var(--txt2);margin:.6rem 0 1rem">Beschreibung</p>
        <div class="det-colors" id="det-colors"></div>
        <div class="det-qty-row">
          <span>Menge:</span>
          <button class="qty-btn" onclick="changeQty(-1)">-</button>
          <span class="qty-val" id="det-qty">1</span>
          <button class="qty-btn" onclick="changeQty(1)">+</button>
        </div>
        <button class="btn btn-pri w-full" onclick="addToCartFromDetail()">ğŸ›’ Zum Warenkorb</button>
      </div>
    </div>
  </div>
</div>

<!-- Cart Modal -->
<div class="modal" id="cartModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('cartModal')">Ã—</button>
    <h2>ğŸ›’ Warenkorb</h2>
    <div id="cart-items"></div>
    <div class="cart-total"><span>Gesamt:</span><span id="cart-total-val">0.00â‚¬</span></div>
    <button class="btn btn-pri w-full" onclick="proceedToCheckout()">ğŸ’³ Zur Kasse</button>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal" id="checkoutModal">
  <div class="modal-box modal-large">
    <button class="modal-x" onclick="closeModal('checkoutModal')">Ã—</button>
    <h2>ğŸ’³ Checkout</h2>
    <form id="checkoutForm" onsubmit="handleCheckout(event)">
      <!-- Shipping method -->
      <div class="fg"><label>Versandart</label>
        <select id="co-shipping-method" onchange="onShippingChange()" required>
          <option value="pickup">Abholung (kostenlos)</option>
          <option value="standard">Standard (4.99â‚¬ â€“ 8.99â‚¬ nach Gewicht)</option>
          <option value="express">Express (9.99â‚¬)</option>
        </select>
      </div>
      <!-- Address fields (hidden if pickup) -->
      <div id="co-address-fields" class="hidden">
        <div class="fg"><label>StraÃŸe & Hausnummer</label><input type="text" id="co-street"></div>
        <div style="display:flex;gap:.7rem">
          <div class="fg" style="flex:1"><label>PLZ</label><input type="text" id="co-zip"></div>
          <div class="fg" style="flex:2"><label>Stadt</label><input type="text" id="co-city"></div>
        </div>
      </div>
      <!-- Coupon -->
      <div class="fg"><label>Gutschein (optional)</label>
        <div style="display:flex;gap:.4rem">
          <input type="text" id="co-coupon" placeholder="Code eingebenâ€¦" style="flex:1">
          <button type="button" class="btn btn-sec btn-sm" onclick="applyCoupon()">EinlÃ¶sen</button>
        </div>
      </div>
      <!-- Payment -->
      <div class="fg"><label>Zahlungsart</label>
        <select id="co-payment" onchange="onPaymentChange()" required>
          <option value="paypal">PayPal</option>
          <option value="stripe">ğŸ’³ Kreditkarte (Stripe)</option>
          <option value="transfer">ğŸ¦ Ãœberweisung</option>
          <option value="privat">ğŸ‘¤ Privat</option>
        </select>
      </div>
      <div class="info-box danger hidden" id="co-priv-warn">
        âš ï¸ <strong>Privat</strong> ist aktuell nur fÃ¼r bekannte Nutzer nutzbar. Falls Sie diese Option trotzdem wÃ¤hlen, kann Ihre Bestellung mÃ¶glicherweise ignoriert werden.
      </div>

      <!-- Summary -->
      <div style="background:var(--card);padding:1rem;border-radius:10px;margin-top:1rem">
        <h4 style="color:var(--green);margin-bottom:.6rem">BestellÃ¼bersicht</h4>
        <div style="color:var(--txt2);font-size:.88rem">
          <div style="display:flex;justify-content:space-between;margin:.3rem 0"><span>Zwischensumme</span><span id="co-subtotal">0.00â‚¬</span></div>
          <div style="display:flex;justify-content:space-between;margin:.3rem 0"><span>Versand</span><span id="co-shipping">0.00â‚¬</span></div>
          <div style="display:flex;justify-content:space-between;margin:.3rem 0"><span>Rabatt</span><span id="co-discount">0.00â‚¬</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:.7rem;padding-top:.6rem;border-top:1px solid var(--border);font-size:1.1rem;color:var(--green);font-weight:700"><span>Gesamt</span><span id="co-total">0.00â‚¬</span></div>
        </div>
      </div>
      <button type="submit" class="btn btn-pri w-full" style="margin-top:1rem">Zahlungspflichtig bestellen</button>
    </form>
  </div>
</div>

<!-- Account Settings -->
<div class="modal" id="settingsModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('settingsModal')">Ã—</button>
    <h2>âš™ï¸ Einstellungen</h2>
    <form onsubmit="saveSettings(event)">
      <div class="fg"><label>E-Mail</label><input type="email" id="set-email" disabled style="opacity:.6"></div>
      <div class="fg"><label>Name</label><input type="text" id="set-name"></div>
      <button type="submit" class="btn btn-pri w-full">ğŸ’¾ Speichern</button>
    </form>
    <button class="btn btn-sec w-full" style="margin-top:.7rem" onclick="closeModal('settingsModal');openModal('changePwModal')">ğŸ” Passwort Ã¤ndern</button>
  </div>
</div>

<!-- Change Password -->
<div class="modal" id="changePwModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('changePwModal')">Ã—</button>
    <h2>ğŸ” Passwort Ã¤ndern</h2>
    <form id="changePwForm" onsubmit="changePassword(event)">
      <div class="fg"><label>Aktuelles Passwort</label><input type="password" id="set-old-pw" required></div>
      <div class="fg"><label>Neues Passwort</label><input type="password" id="set-new-pw" required minlength="6"></div>
      <div class="fg"><label>Neues Passwort wiederholen</label><input type="password" id="set-new-pw2" required></div>
      <div class="err hidden" id="set-pw-err"></div>
      <button type="submit" class="btn btn-pri w-full mt1">Passwort Ã¤ndern</button>
    </form>
  </div>
</div>

<!-- Admin: Notify Customer -->
<div class="modal" id="notifyModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('notifyModal')">Ã—</button>
    <h2>ğŸ“¨ Kunde benachrichtigen</h2>
    <div class="fg"><label>Nachricht</label><textarea id="notify-msg" placeholder="Ihre Nachricht an den Kundenâ€¦"></textarea></div>
    <label style="color:var(--txt2);font-size:.85rem;font-weight:500">Ã„nderungen mitteilen</label>
    <div class="notify-type-btns mt1">
      <button type="button" class="notify-type-btn" data-type="cost"  onclick="toggleNotifyType('cost')">ğŸ’° KostenÃ¤nderung</button>
      <button type="button" class="notify-type-btn" data-type="time"  onclick="toggleNotifyType('time')">â±ï¸ ZeitÃ¤nderung</button>
    </div>
    <div class="fg hidden" id="notify-cost-change" style="margin-top:.6rem"><label>KostenÃ¤nderung (z.B. â€wird ca. 5â‚¬ mehr kosten")</label><input type="text" id="notify-cost-val"></div>
    <div class="fg hidden" id="notify-time-change" style="margin-top:.4rem"><label>ZeitÃ¤nderung (z.B. â€dauert ca. 2 Tage lÃ¤nger")</label><input type="text" id="notify-time-val"></div>
    <button class="btn btn-pri w-full mt1" onclick="sendNotification()">ğŸ“¤ Senden</button>
  </div>
</div>

<!-- Admin: Add to Gallery -->
<div class="modal" id="addGalleryModal">
  <div class="modal-box">
    <button class="modal-x" onclick="closeModal('addGalleryModal')">Ã—</button>
    <h2>ğŸ–¼ï¸ Zur Galerie hinzufÃ¼gen</h2>
    <div class="prod-list" id="gallery-add-list"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â• -->
<footer>Â© 2026 JT Print â€“ Alle Rechte vorbehalten</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â• FIREBASE MODULE INIT â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
  import { initializeApp }           from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
  import { getFirestore, collection, addDoc, getDocs, doc, setDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

  // â”€â”€ Firebase Config â”€â”€
  const firebaseConfig = {
    apiKey: "AIzaSyDazql6oJx5_z3hASwmo4200-OpQhodZVc",
    authDomain: "d-druckservice-jtprint.firebaseapp.com",
    projectId: "d-druckservice-jtprint",
    storageBucket: "d-druckservice-jtprint.firebasestorage.app",
    messagingSenderId: "247787543764",
    appId: "1:247787543764:web:b3cc1e7d05eb8aa2abef41"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // Expose helpers globally
  window.fbAuth = auth;
  window.fbDb   = db;
  window.fbFuncs = {
    createUser:       createUserWithEmailAndPassword,
    signIn:           signInWithEmailAndPassword,
    sendVerifyEmail:  sendEmailVerification,
    signOutFn:        signOut,
    collection:       collection,
    doc:              doc,
    setDoc:           setDoc,
    updateDoc:        updateDoc,
    deleteDoc:        deleteDoc,
    addDoc:           addDoc,
    getCollectionDocs: async (database, collName) => {
      const snap = await getDocs(collection(database, collName));
      const arr  = [];
      snap.forEach(d => arr.push({ id: d.id, ...d.data() }));
      return arr;
    }
  };

  // Auth state listener
  onAuthStateChanged(auth, (user) => {
    window.currentUser = user;
    if (user) {
      window.isAdmin = (user.email === 'jona.thielgen@gmail.com');
      renderNav();
      loadUserNotifications();
      if (window.isAdmin) addNotification('Admin-Modus', 'Willkommen zurÃ¼ck, Jona!');
    } else {
      window.isAdmin = false;
      window.notifications = [];
      renderNav();
      showShop();
    }
  });
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â• -->
<script src="script.js"></script>
<script src="script_shop.js"></script>
<script src="script_admin.js"></script>

<!-- â•â•â•â•â•â•â•â•â•â•â• INLINE GLUE â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// Product tab switcher (shop)
function switchProdTab(name, btn) {
  document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('internet-tab').classList.toggle('active', name === 'internet');
  document.getElementById('custom-tab').classList.toggle('active', name === 'custom');
}

// Smooth scroll helper - RENAMED to avoid conflict with window.scrollTo
function smoothScrollTo(id) { 
  const el = document.getElementById(id); 
  if (el) el.scrollIntoView({ behavior:'smooth', block:'start' }); 
}

// Close modals on backdrop click
document.querySelectorAll('.modal').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); });
});
</script>

<!-- IMPROVED PRICE CALC STYLES -->
<style>
.price-calc {
  background: linear-gradient(135deg, var(--card) 0%, rgba(0, 204, 153, 0.05) 100%);
  border: 2px solid var(--green);
  border-radius: 12px;
  padding: 0;
  margin-top: 1.5rem;
  overflow: hidden;
}

.price-header {
  background: var(--green);
  padding: 1rem 1.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.price-header h4 {
  margin: 0;
  color: var(--bg);
  font-size: 1rem;
  font-weight: 600;
}

.price-amt {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--bg);
  font-family: 'Orbitron', sans-serif;
}

.price-breakdown-wrapper {
  padding: 1.2rem;
}

.price-breakdown {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
  font-size: 0.92rem;
  line-height: 1.8;
  color: var(--txt2);
}

.price-breakdown strong {
  color: var(--green);
  font-weight: 600;
}

.disc-badge {
  background: var(--green);
  color: var(--bg);
  padding: 0.15rem 0.4rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 700;
  margin-left: 0.3rem;
}

.orig-price {
  text-decoration: line-through;
  opacity: 0.5;
  margin-left: 0.3rem;
  font-size: 0.85rem;
}
</style>
</body>
</html>
