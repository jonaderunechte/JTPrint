<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JT Print - Professioneller 3D-Druck Service</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Header -->
    <header>
        <nav>
            <div class="logo-container" onclick="goToHome()" style="cursor: pointer;">
                <img src="https://i.postimg.cc/433yTPrC/296ae7d7-58c3-4968-b8a8-e6b6add85135-removebg-preview.png" alt="JT Print Logo" class="logo-image">
                <span class="logo-text">JT Print</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#gallery">Galerie</a></li>
                <li><a href="#products">Produkte</a></li>
                
                <!-- Admin Tabs (nur sichtbar wenn Admin eingeloggt) -->
                <li class="hidden admin-only">
                    <a href="javascript:void(0);" onclick="event.preventDefault(); showAdminPanel('orders');">üì¶ Bestellungen</a>
                </li>
                <li class="hidden admin-only">
                    <a href="javascript:void(0);" onclick="event.preventDefault(); showAdminPanel('products');">üõçÔ∏è Produkte</a>
                </li>
                <li class="hidden admin-only">
                    <a href="javascript:void(0);" onclick="event.preventDefault(); showAdminPanel('chat');">üí¨ Chats</a>
                </li>
                
                <li id="nav-auth">
                    <button class="btn-secondary" onclick="showLoginModal()">Anmelden</button>
                </li>
                <li class="hidden" id="nav-settings">
                    <button class="btn-secondary" onclick="showSettingsModal()">‚öôÔ∏è</button>
                </li>
                <li class="hidden" id="nav-cart">
                    <div class="cart-icon" onclick="showCart()">
                        üõí <span class="cart-count">0</span>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Public Site -->
    <div id="publicSite">
        <!-- Hero Section -->
        <section class="hero" id="home">
            <h1>Professioneller 3D-Druck f√ºr Ihre Ideen</h1>
            <p>Laden Sie Ihr Design hoch oder lassen Sie uns Ihr individuelles 3D-Modell erstellen. Pr√§zise Fertigung mit modernster Technologie.</p>
            <div class="hero-buttons">
                <button class="btn-primary" onclick="showUploadModal()">Design hochladen</button>
                <button class="btn-secondary" onclick="showCustomDesignModal()">Custom Design anfragen</button>
            </div>
        </section>

        <!-- Main Container -->
        <div class="container">
            <!-- Services Section -->
            <section id="services">
                <h2 class="section-title">Unsere Services</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <h3>üñ®Ô∏è 3D-Druck Service</h3>
                        <p>Laden Sie Ihre STL-Datei hoch oder beschreiben Sie Ihr Wunschmodell. Wir drucken es f√ºr Sie mit hochwertigen Materialien.</p>
                        <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                            <li>Bambu Lab P1S Drucker</li>
                            <li>Druckgr√∂√üe bis 25x25cm</li>
                            <li>Zwei Nozzle-Optionen</li>
                            <li>50% Rabatt auf PLA-Grundpreis!</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <h3>‚úèÔ∏è Custom Design Service</h3>
                        <p>Ben√∂tigen Sie ein individuelles 3D-Modell? Beschreiben Sie Ihre Idee und wir erstellen das perfekte Design f√ºr Sie.</p>
                        <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                            <li>Professionelle CAD-Modellierung</li>
                            <li>OnShape-Software</li>
                            <li>20‚Ç¨/Stunde oder VB</li>
                            <li>Design + Fertigung</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <h3>‚ö° Express-Service</h3>
                        <p>Brauchen Sie Ihr Modell schnell? Mit unserem Express-Service erhalten Sie Ihren Druck priorisiert.</p>
                        <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                            <li>Bevorzugte Bearbeitung</li>
                            <li>Schnellere Lieferung</li>
                            <li>Status-Updates</li>
                            <li>+30% Aufpreis</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Gallery Section -->
            <section id="gallery">
                <h2 class="section-title">Portfolio & Beispiele</h2>
                <div class="product-grid" id="gallery-grid"></div>
            </section>

            <!-- Products Section -->
            <section id="products">
                <h2 class="section-title">Produktkatalog</h2>
                
                <div class="tabs">
                    <!-- NUR DIESE STELLEN SIND GE√ÑNDERT -->
                    <button class="tab active" onclick="switchTab('internet', event)">Internet-Modelle</button>
                    <button class="tab" onclick="switchTab('custom', event)">Eigene Designs</button>
                </div>

                <div id="internet-tab" class="tab-content active">
                    <div class="product-grid" id="internet-products"></div>
                </div>

                <div id="custom-tab" class="tab-content">
                    <div class="product-grid" id="custom-products"></div>
                </div>
            </section>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <div class="container">
            <!-- Order Management -->
            <div id="adminOrders" class="admin-section">
                <h2 class="section-title">üì¶ Bestellverwaltung</h2>
                <div id="ordersList"></div>
            </div>

            <!-- Product Management -->
            <div id="adminProducts" class="admin-section hidden">
                <h2 class="section-title">üõçÔ∏è Produktverwaltung</h2>
                <button class="btn-primary" onclick="showAddProductModal()" style="margin-bottom: 2rem;">‚ûï Neues Produkt hinzuf√ºgen</button>
                <div id="adminProductsList"></div>
            </div>

            <!-- Chat Management -->
            <div id="adminChat" class="admin-section hidden">
                <h2 class="section-title">üí¨ Chat-Verwaltung</h2>
                <div id="chatsList"></div>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div class="chat-widget">
        <button class="chat-button" onclick="toggleChat()">üí¨</button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                Custom Design Anfrage
                <button class="modal-close" onclick="toggleChat()" style="position: absolute; right: 1rem; top: 0.5rem; color: white;">&times;</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message admin">
                    Hallo! Ich bin hier um Ihnen bei Ihrem Custom Design zu helfen. Beschreiben Sie mir einfach Ihre Idee und ich erstelle Ihnen ein Angebot.<br><br>
                    <strong>Mein Stundensatz: 20‚Ç¨/h oder Preisvorschlag</strong><br><br>
                    <em style="font-size: 0.9rem; color: var(--text-secondary);">
                        Hinweis: Ich werde Sie m√∂glicherweise nach weiteren Informationen √ºber das Design fragen (Ma√üe, Funktionen, Pr√§ferenzen etc.), um das beste Ergebnis zu erzielen.
                    </em>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ihre Nachricht..." onkeypress="handleChatKeyPress(event)">
                <button class="btn-primary" onclick="sendChatMessage()" style="padding: 0.75rem 1rem;">Senden</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
            <h2>Anmelden</h2>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div id="loginError" class="error-message hidden"></div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Anmelden</button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary);">
                Noch kein Konto? <a href="#" onclick="showRegisterModal()" style="color: var(--primary-green);">Registrieren</a>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
            <h2>Registrieren</h2>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label>Geburtsdatum</label>
                    <input type="date" id="registerBirthdate" required>
                </div>
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Passwort wiederholen</label>
                    <input type="password" id="registerPasswordConfirm" required>
                </div>
                <div id="registerError" class="error-message hidden"></div>
                <div id="registerSuccess" class="success-message hidden"></div>
                <div id="registerEmailInfo" class="hidden" style="background: rgba(0, 204, 153, 0.1); border: 1px solid var(--primary-green); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <p style="color: var(--primary-green); font-weight: 600;">üìß E-Mail-Best√§tigung erforderlich</p>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                        Wir haben Ihnen eine Best√§tigungs-E-Mail gesendet. Bitte √ºberpr√ºfen Sie auch Ihren <strong>Spam-Ordner</strong>, falls Sie die E-Mail nicht finden!
                    </p>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Registrieren</button>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('settingsModal')">&times;</button>
            <h2>Kontoeinstellungen</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="settingsName" readonly>
            </div>
            <div class="form-group">
                <label>E-Mail</label>
                <input type="email" id="settingsEmail" readonly>
            </div>
            <div class="form-group">
                <label>Mitglied seit</label>
                <input type="text" id="settingsMemberSince" readonly>
            </div>
            <h3 style="color: var(--primary-green); margin: 2rem 0 1rem;">Benachrichtigungen</h3>
            <div id="notificationsList"></div>
            <button class="btn-secondary" onclick="handleLogout()" style="width: 100%; margin-top: 2rem;">Abmelden</button>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('uploadModal')">&times;</button>
            <h2>3D-Modell hochladen</h2>
            <form id="uploadForm" onsubmit="handleUpload(event)">
                <div class="form-group">
                    <label>STL-Datei oder Beschreibung</label>
                    <textarea id="uploadDescription" placeholder="Beschreiben Sie Ihr Wunschmodell oder laden Sie eine STL-Datei hoch..." required></textarea>
                </div>
                
                <div class="price-calculator">
                    <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Preiskalkulator</h3>
                    <div class="form-group">
                        <label>Gesch√§tztes Gewicht (Gramm)</label>
                        <input type="number" id="weight" min="1" step="0.1" required oninput="calculatePrice()">
                    </div>
                    <div class="form-group">
                        <label>Material</label>
                        <select id="material" onchange="calculatePrice()">
                            <option value="pla">PLA (50% Rabatt!)</option>
                            <option value="tpu">TPU (+10‚Ç¨)</option>
                            <option value="asa">ASA (+10‚Ç¨)</option>
                            <option value="abs">ABS (+10‚Ç¨)</option>
                            <option value="petg">PETG (+10‚Ç¨)</option>
                            <option value="pla-cf">PLA Carbon Fiber (+10‚Ç¨)</option>
                            <option value="petg-cf">PETG Carbon Fiber (+10‚Ç¨)</option>
                            <option value="pla-wood">PLA Wood (+10‚Ç¨)</option>
                            <option value="pla-glow">PLA Glow in the Dark (+10‚Ç¨)</option>
                            <option value="pla-marble">PLA Marble (+10‚Ç¨)</option>
                            <option value="pla-silk">PLA Silk (+10‚Ç¨)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nozzle-Gr√∂√üe</label>
                        <select id="nozzle" onchange="calculatePrice()">
                            <option value="0.4">0.4mm Hardened Steel (Standard)</option>
                            <option value="0.2">0.2mm Stainless Steel (+4‚Ç¨, nur PLA)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Express-Service</label>
                        <select id="express" onchange="calculatePrice()">
                            <option value="no">Nein</option>
                            <option value="yes">Ja (+30%)</option>
                        </select>
                    </div>
                    <div class="price-result hidden" id="priceResult">
                        <p>Gesch√§tzter Preis:</p>
                        <p class="amount" id="priceAmount">0.00‚Ç¨</p>
                        <p style="font-size: 0.875rem; opacity: 0.8;" id="priceBreakdown"></p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Anmerkungen (optional)</label>
                    <textarea id="uploadNotes" placeholder="Besondere W√ºnsche, Farben, etc."></textarea>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">In den Warenkorb</button>
            </form>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="modal">
        <div class="modal-content modal-content-large">
            <button class="modal-close" onclick="closeModal('productDetailModal')">&times;</button>
            <div class="product-detail-grid">
                <div>
                    <div id="detailImage" style="width: 100%; height: 300px; background: var(--card-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 4rem; overflow: hidden;"></div>
                </div>
                <div>
                    <h2 id="detailName"></h2>
                    <p id="detailDescription" style="color: var(--text-secondary); margin: 1rem 0;"></p>
                    <div style="margin: 1rem 0;">
                        <span class="product-price" id="detailPrice"></span>
                    </div>
                    
                    <div class="form-group">
                        <label>Farbe w√§hlen</label>
                        <div class="color-selector" id="colorSelector"></div>
                    </div>

                    <div class="form-group">
                        <label>Menge</label>
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                            <span class="quantity-display" id="quantityDisplay">1</span>
                            <button type="button" class="quantity-btn" onclick="changeQuantity(1)">+</button>
                        </div>
                    </div>

                    <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="addDetailProductToCart()">In den Warenkorb</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close" onclick="closeModal('cartModal')">&times;</button>
            <h2>Warenkorb</h2>
            <div id="cartItems"></div>
            <div id="cartTotal" style="margin-top: 2rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                <h3 style="text-align: right; color: var(--primary-green);">Gesamt: <span id="totalAmount">0.00‚Ç¨</span></h3>
            </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="proceedToCheckout()">Zur Kasse</button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeModal('checkoutModal')">&times;</button>
            <h2>Bestellung abschlie√üen</h2>
            <form id="checkoutForm" onsubmit="handleCheckout(event)">
                <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Lieferung</h3>
                <div class="form-group">
                    <label>Versandart</label>
                    <select id="shippingMethod" onchange="updateShipping()" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="pickup">Selbstabholung (Kostenlos)</option>
                        <option value="standard">Standard-Versand (4.99‚Ç¨)</option>
                        <option value="express">Express-Versand (9.99‚Ç¨)</option>
                    </select>
                </div>

                <div id="addressFields" class="hidden">
                    <div class="form-group">
                        <label>Stra√üe und Hausnummer</label>
                        <input type="text" id="street">
                    </div>
                    <div class="form-group">
                        <label>Postleitzahl</label>
                        <input type="text" id="zipCode">
                    </div>
                    <div class="form-group">
                        <label>Stadt</label>
                        <input type="text" id="city">
                    </div>
                    <div class="form-group">
                        <label>Land</label>
                        <input type="text" id="country" value="Deutschland">
                    </div>
                </div>

                <h3 style="color: var(--primary-green); margin: 2rem 0 1rem;">Gutscheincode</h3>
                <div class="form-group">
                    <input type="text" id="couponCode" placeholder="Gutscheincode eingeben">
                    <button type="button" class="btn-secondary" style="margin-top: 0.5rem;" onclick="applyCoupon()">Einl√∂sen</button>
                </div>

                <h3 style="color: var(--primary-green); margin: 2rem 0 1rem;">Zahlungsmethode</h3>
                <div class="form-group">
                    <select id="paymentMethod" onchange="checkPrivatePayment()" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="paypal">PayPal</option>
                        <option value="stripe">Kreditkarte (Stripe)</option>
                        <option value="transfer">√úberweisung</option>
                        <option value="private">Privat (nur f√ºr Bekannte)</option>
                    </select>
                </div>
                <div id="privatePaymentWarning" class="hidden" style="background: rgba(255, 68, 68, 0.1); border: 1px solid var(--red-accent); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <p style="color: var(--red-accent); font-weight: 600;">‚ö†Ô∏è Achtung:</p>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Die Option "Privat" ist aktuell nur f√ºr bekannte Nutzer verf√ºgbar. Wenn Sie diese Zahlungsoption trotzdem ausw√§hlen, wird Ihre Bestellung m√∂glicherweise ignoriert.</p>
                </div>

                <div style="background: var(--card-bg); padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">
                    <h4 style="color: var(--primary-green);">Bestell√ºbersicht</h4>
                    <div style="margin-top: 1rem; color: var(--text-secondary);">
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Zwischensumme:</span>
                            <span id="checkoutSubtotal">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Versandkosten:</span>
                            <span id="shippingCost">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Rabatt:</span>
                            <span id="discount">0.00‚Ç¨</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); font-size: 1.25rem; color: var(--primary-green); font-weight: 700;">
                            <span>Gesamt:</span>
                            <span id="checkoutTotal">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%;">Zahlungspflichtig bestellen</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Product Modal (Admin) -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
            <h2 id="productModalTitle">Neues Produkt hinzuf√ºgen</h2>
            <form id="productForm" onsubmit="handleAddProduct(event)">
                <div class="form-group">
                    <label>Produktname</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Beschreibung</label>
                    <textarea id="productDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label>Preis (‚Ç¨)</label>
                    <input type="number" id="productPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Kategorie</label>
                    <select id="productCategory" required>
                        <option value="internet">Internet-Modelle</option>
                        <option value="custom">Eigene Designs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Gewicht (Gramm)</label>
                    <input type="number" id="productWeight" min="1" required>
                </div>
                <div class="form-group">
                    <label>Bild (Emoji oder URL)</label>
                    <input type="text" id="productImage" placeholder="z.B. üì± oder https://..." required>
                    <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                        F√ºr einzelnes Bild
                    </small>
                </div>
                <div class="form-group">
                    <label>Mehrere Bilder f√ºr verschiedene Farben (optional)</label>
                    <textarea id="productImages" placeholder="Ein Bild pro Zeile (in der gleichen Reihenfolge wie die Farben)&#10;z.B.:&#10;https://bild-schwarz.jpg&#10;https://bild-weiss.jpg&#10;https://bild-blau.jpg"></textarea>
                    <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                        Falls leer, wird das einzelne Bild oben f√ºr alle Farben verwendet
                    </small>
                </div>
                <div class="form-group">
                    <label>Verf√ºgbare Farben (Hex-Codes, kommagetrennt)</label>
                    <input type="text" id="productColors" placeholder="z.B. #000000,#FFFFFF,#0066cc" required>
                </div>
                <div class="form-group">
                    <label>Auf Lager</label>
                    <select id="productInStock">
                        <option value="true">Ja</option>
                        <option value="false">Nein</option>
                    </select>
                </div>
                <input type="hidden" id="editProductId">
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">Speichern</button>
            </form>
        </div>
    </div>

    <!-- Message Customer Modal (Admin) -->
    <div id="messageCustomerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('messageCustomerModal')">&times;</button>
            <h2>Kunde benachrichtigen</h2>
            <form id="messageForm" onsubmit="handleSendMessage(event)">
                <div class="form-group">
                    <label>Empf√§nger</label>
                    <input type="text" id="messageRecipient" readonly>
                </div>
                <div class="form-group">
                    <label>Nachricht</label>
                    <textarea id="messageText" required placeholder="Ihre Nachricht an den Kunden..."></textarea>
                </div>
                <input type="hidden" id="messageUserId">
                <button type="submit" class="btn-primary" style="width: 100%;">Nachricht senden</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, doc, setDoc, updateDoc, deleteDoc, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // TODO: Replace with your Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyDazql6oJx5_z3hASwmo4200-OpQhodZVc",
          authDomain: "d-druckservice-jtprint.firebaseapp.com",
          projectId: "d-druckservice-jtprint",
          storageBucket: "d-druckservice-jtprint.firebasestorage.app",
          messagingSenderId: "247787543764",
          appId: "1:247787543764:web:b3cc1e7d05eb8aa2abef41"
     };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            sendEmailVerification, 
            onAuthStateChanged,
            signOut
        };
        window.firebaseDbFunctions = { collection, addDoc, getDocs, query, where, doc, setDoc, updateDoc, deleteDoc, orderBy, onSnapshot };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const isAdmin = user.email === 'jona.thielgen@gmail.com';
                
                document.getElementById('nav-auth').innerHTML = `
                    <span style="color: var(--text-secondary);">${user.email}</span>
                    <button class="btn-secondary" onclick="handleLogout()">Abmelden</button>
                `;
                document.getElementById('nav-settings').classList.remove('hidden');
                document.getElementById('nav-cart').classList.remove('hidden');
                
                if (isAdmin) {
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
                    window.isAdmin = true;
                } else {
                    window.isAdmin = false;
                }
                
                await loadUserData(user);
                loadProducts();
                
                if (isAdmin) {
                    loadOrders();
                    loadChats();
                }
            } else {
                document.getElementById('nav-auth').innerHTML = `
                    <button class="btn-secondary" onclick="showLoginModal()">Anmelden</button>
                `;
                document.getElementById('nav-settings').classList.add('hidden');
                document.getElementById('nav-cart').classList.add('hidden');
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
                window.isAdmin = false;
                showPublicSite();
                loadProducts();
            }
        });

        async function loadUserData(user) {
            try {
                const userDoc = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.query(
                        window.firebaseDbFunctions.collection(window.firebaseDb, 'users'),
                        window.firebaseDbFunctions.where('email', '==', user.email)
                    )
                );
                
                if (!userDoc.empty) {
                    window.currentUserData = userDoc.docs[0].data();
                    window.currentUserData.uid = user.uid;
                }
            } catch (error) {
                console.log('Error loading user data:', error);
            }
        }
    </script>

    <script src="script.js"></script>
</body>
    <script>
        function showSettingsModal() {
    if (!window.firebaseAuth.currentUser || !currentUserData) return;
    
    document.getElementById('settingsName').value = currentUserData.name || '';
    document.getElementById('settingsEmail').value = currentUserData.email || '';
    document.getElementById('settingsMemberSince').value = currentUserData.createdAt ? new Date(currentUserData.createdAt).toLocaleDateString('de-DE') : '';
    
    loadNotifications();
    document.getElementById('settingsModal').classList.add('active');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}
 </script>
</html>
